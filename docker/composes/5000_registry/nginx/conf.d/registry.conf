upstream docker-registry {
    server localhost:5000;
}

server {
    listen 443;
    server_name registry.tonychoucc.com;

    ssl on;
    ssl_certificate /etc/ssl/certs/docker-registry.crt;  # Public Certificate
    ssl_certificate_key /etc/ssl/private/docker-registry.key;  # Private Key

    # 避免 HTTP 413 (Large image uploads)
    client_max_body_size 0;

    # 避免 HTTP 411
    chunked_transfer_encoding on;

    location / {
        auth_basic  "Restricted";
        auth_basic_user_file    registry.htpasswd;
        include docker-registry.conf;
    }

    location /_ping {
        auth_basic off;
        include docker-registry.conf;
    }

    location /v1/_ping {
        auth_basic off;
        include docker-registry.conf;
    }
}